# アカウント機能・デバイス間データ同期 実装計画

## 目的とゴール
ユーザーがどのデバイス（PC、スマートフォン等）からアクセスしても、自身の「戦略マップ」「MABボード」「保存されたログ」などの同一データを確認・編集できるように、アカウント機能およびクラウドデータ同期機能を実装します。

## アーキテクチャ構成の提案
現在のアプリケーションは、フロントエンド（HTML/CSS/JS）とLocalStorageのみで動作する完全なサーバーレス・SPA構成です（サーバーは静的ファイルの配信のみ）。
バックエンドを新規にフルスクラッチで開発すると工数がかかるため、**Firebase**（Googleのモバイル・Webアプリケーション向けプラットフォーム）の導入を提案します。

- **認証 (Firebase Authentication)**: 
  ユーザーを識別するためのログイン機能です。「Googleアカウントでログイン」機能を使用するのが、ユーザーにとって最もサインインの手間が省け「楽」です（メール/パスワード認証も追加可能です）。
- **データ保存 (Cloud Firestore)**: 
  現在 `LocalStorage` に保存されているJSONデータを、ユーザーごとのクラウドデータベースに保存し、デバイス間でリアルタイムに同期します。

## User Review Required
> [!IMPORTANT]
> この計画を進めるためには、ユーザー（あなた）ご自身で以下の準備が必要です。
> 1. [Firebase Console](https://console.firebase.google.com/) で新規プロジェクトを作成する。
> 2. **Authentication** で「Googleログイン」を有効化する。
> 3. **Firestore Database** を作成し、テストモード（または認証済みユーザーのみアクセス可能なルール）で初期化する。
> 4. Webアプリとしての「設定情報（Firebase Config）」を取得する。
> 
> ※この作業の具体的な手順も、本実装の際にサポート可能です。このFirebaseを利用する方針で進めてよいか教えてください。

## Proposed Changes

### フロントエンド (UIとロジック)
現状のHTML/JSファイルに対して、Firebaseとの連携機能を追加します。

#### [MODIFY] `index.html`
- Firebase SDK（Firebase v9 または v10 のモジュール版）の読み込み設定を追加します。
- ヘッダー部分などに「ログイン」「ログアウト」ボタン、およびログイン中のユーザー名（またはアイコン）を表示するUIメニューを追加します。
- 必要に応じて、データ読み込み中のローディング（スピナー）画面を追加します。

#### [MODIFY] `style.css`
- 追加したログインボタンやユーザープロファイル表示、ローディングUIのためのスタイル（Glassmorphismなどに合わせたデザイン）を追加します。

#### [MODIFY] `script.js`
このファイルには大きなロジックの変更が入ります。
- **Firebase 初期化**: Firebaseの設定情報（Config）を読み込み、初期化します。
- **認証状態の監視**: `onAuthStateChanged` を用いて、ユーザーがログインしているかを判定します。
- **データ同期ロジックの改修**:
  - 現在の `saveData()` 関数を改修し、LocalStorageに保存すると同時に、ログイン中であれば **Firestore にもデータを保存**（アップロード）するようにします。
  - 現在の `loadData()` 関数を改修し、ログイン直後に **Firestore からデータを取得**（ダウンロード）し、画面を描画し直す仕組みを追加します。
  - ※未ログイン時は今まで通り LocalStorage のみを使用するようにフォールバックさせることも可能です。

## Verification Plan
変更機能の検証方法です。

### Manual Verification
1. **ログイン・ログアウトの検証**
   - ブラウザでアクセスし、ヘッダーの「ログイン」ボタンからGoogleアカウントでログインできるか確認する。
   - ログイン後にユーザー名などが表示され、「ログアウト」ボタンが機能するか確認する。
2. **デバイス間同期の検証**
   - **PC** のブラウザでログインし、「戦略マップ」や「アーム」を新たに追加する。
   - **スマートフォン** または別のブラウザ（シークレットウィンドウなど）から同じアカウントでログインする。
   - PCで追加したデータが、スマートフォンの画面にも正常に表示されているか（同期されているか）を確認する。
3. **オフライン・未ログイン時の検証**（オプション）
   - 未ログインの状態でデータが正常に LocalStorage にのみ保存され、アプリがこれまで通り動作するかを確認する。
